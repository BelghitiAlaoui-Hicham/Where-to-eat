/*! Where-to-eat - v0.1.0 - 2014-09-09
* Copyright (c) 2014 ; Licensed  */
!function(a){"use strict";var b=function(b){this.element=a(b)};b.prototype={constructor:b,show:function(){var b,c,d,e=this.element,f=e.closest("ul:not(.dropdown-menu)"),g=e.attr("data-target");g||(g=e.attr("href"),g=g&&g.replace(/.*(?=#[^\s]*$)/,"")),e.parent("li").hasClass("active")||(b=f.find(".active a").last()[0],d=a.Event("show",{relatedTarget:b}),e.trigger(d),d.isDefaultPrevented()||(c=a(g),this.activate(e.parent("li"),f),this.activate(c,c.parent(),function(){e.trigger({type:"shown",relatedTarget:b})})))},activate:function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one(a.support.transition.end,e):e(),f.removeClass("in")}},a.fn.tab=function(c){return this.each(function(){var d=a(this),e=d.data("tab");e||d.data("tab",e=new b(this)),"string"==typeof c&&e[c]()})},a.fn.tab.Constructor=b,a(function(){a("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")})})}(window.jQuery),function(a){"use strict";a.Cookie={},a.Cookie.createCookie=function(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"},a.Cookie.readCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},a.Cookie.eraseCookie=function(b){a.Cookie.createCookie(b,"",-1)}}(window.Josh=window.Josh||{}),function(a,b){"use strict";var c;a.Socket=function(a){d(a)};var d=function(a){c=io.connect(a)};return a.Socket.prototype.addEvent=function(a,d){c.on(a,function(c){b(d).trigger(a,c)})},a.Socket.prototype.getVotes=function(){c.emit("getVotes")},a.Socket.prototype.getUsers=function(){c.emit("get")},a.Socket.prototype.addUser=function(a,b,d,e){c.emit("add",a,b,d,function(){e()})},a.Socket.prototype.addVote=function(a){var d=b.extend(!0,{},a);delete d.marker,delete d.user,c.emit("addVote",d)},a.Socket}(window.Josh=window.Josh||{},window.jQuery),function(a){"use strict";a.User=function(a,b){this.username=a,this.img=b,this.imgHTML='<img src="'+b+'" class="userimg" title="'+a+'">'}}(window.Josh=window.Josh||{}),function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m,n,o=function(){};a.Map=function(p){m=new a.Socket("http://"+location.host+"/users"),this.map=new L.Map(p,{zoomAnimation:!0});var q=new L.StamenTileLayer("toner-lite");this.map.addLayer(q),c=L.Icon.extend({options:{shadowUrl:null,iconSize:new L.Point(32,32)}}),d=document.getElementById("fsRest"),f=document.getElementById("acts"),e=document.getElementById("votes"),g=document.getElementById("loginArea"),h=document.getElementById("search"),i=b("#searchText"),j=document.getElementById("clear"),k=b("#title"),n=b("#alert");var r=this;navigator.geolocation.getCurrentPosition(function(a){r.centerLoc(a)},o,{timeout:1e4}),b(d).on("click","button",function(a){var c=b(a.target);if(null!==r.currentUser){var d=c.attr("data-fsid"),e=r.findFs(d);m.addVote(e)}else r.addAlert("You must be logged in!")}),b(e).on("click","li a",function(a){a.preventDefault(),r.showRest(b(a.target).attr("data-fsid"))}),b(f).on("click","li a",function(a){a.preventDefault(),r.showRest(b(a.target).attr("data-fsid"))}),b(g).on("focusout","input",function(a){var c=b(a.target).val();r.addUser(c)}),b(g).on("click","a",function(a){a.preventDefault(),r.removeUser()}),b(h).on("click",function(a){r.addAlert("Searching for Restaurants"),a.preventDefault(),r.findRests(i.val()),r.removeAlert()}),b(j).on("click",function(a){a.preventDefault(),i.val(""),r.addSearchLayer({})}),n.on("click",function(){r.removeAlert()}),this.searchFs={},this.voteFs=new a.Votes,this.currentUser=null,this.searchLayer=null,this.location=null,m.addEvent("vote",this),b(this).on("vote",function(b,c){if(void 0===this.voteFs.votes[c.fs.id]){var d=this.addMarker(c.fs);c.fs.marker=d}c.fs.user=[new a.User(c.username,c.img)],this.addActivity(c.fs.user[0],c.fs.name,c.fs.id),this.voteFs.addVote(c.fs),this.showVotes()}),m.addEvent("serverError",this),b(this).on("serverError",function(a,b){this.addAlert(b.message)}),b(this.voteFs).on("removeLayer",function(a,b){r.removeLayer(b)}),window.addEventListener("hashchange",function(){window.location.reload()}),window.location.hash?(l=String(window.location.hash).slice(1),k.html(l)):l="default";var s=a.Cookie.readCookie("username");null!==s&&this.addUser(s)},a.Map.prototype={centerLoc:function(a){this.location=a;var b=new L.LatLng(this.location.coords.latitude,this.location.coords.longitude);this.map.setView(b,13)},addMarker:function(a,b){b="undefined"!=typeof b?b:!0;var d;d=a.categories.length>0?new c({iconUrl:a.categories[0].icon.prefix+"bg_32"+a.categories[0].icon.suffix}):new L.Icon({iconUrl:"images/marker.png"});var e=new L.LatLng(a.location.lat,a.location.lng),f=new L.Marker(e,{icon:d,title:a.name});return f.fsid=a.id,f.img=d.iconUrl,f.on("click",this.showRestProxy.bind(this)),b&&this.map.addLayer(f),f},removeMarker:function(a){a.clearAllEventListeners()},removeLayer:function(a){if(void 0!==a.getLayers)for(var b=a.getLayers(),c=0;c<b.length;c++)this.removeMarker(b[c]);this.map.removeLayer(a)},addSearchLayer:function(a){null!==this.searchLayer&&this.removeLayer(this.searchLayer),this.searchLayer=new L.LayerGroup;for(var b in a){this.addSearchFs(a[b]);var c=this.addMarker(a[b],!1);this.searchLayer.addLayer(c)}this.map.addLayer(this.searchLayer)},showRestProxy:function(a){this.showRest(a.target.fsid)},showRest:function(a){var c,e=this.findFs(a);c=e.categories.length>0?e.categories[0].icon.prefix+"bg_32"+e.categories[0].icon.suffix:"images/marker.png";var f='<h3><img src="'+c+'">'+e.name+"</h3>";if(void 0!==e.phone&&(f+="<div>Phone: "+e.phone+"</div>"),void 0!==e.menu&&(f+='<div><a href="'+e.menu.url+'" target="_blank">Menu</a></div>'),void 0!==e.user){f+="<div>Votes: "+e.user.length+"</div>",f+="<div>";for(var g=0;g<e.user.length;g++)f+=e.user[g].imgHTML;f+="</div>"}f+='<button class="btn" data-fsid="'+e.id+'">Vote for Me</button>',b(d).html(f)},addSearchFs:function(a){this.searchFs[a.id]=a},removeSearchFs:function(){this.searchFs={}},findFs:function(a){return this.voteFs.votes[a]?this.voteFs.votes[a]:this.searchFs[a]},addUser:function(c){if(""!==c){var d,e=new RegExp("^(fb:)?"),f=c.split(e);f.length>1?(d=f[f.length-2],c=f[f.length-1]):d="gravatar";var h;if(d&&"fb:"===d)h=document.createElement("img"),h.setAttribute("src","https://graph.facebook.com/"+c+"/picture?type=square");else if(null!==a.Cookie.readCookie("img"))h=document.createElement("img"),h.setAttribute("src",a.Cookie.readCookie("img"));else{var i=md5(c.toLowerCase());h=document.createElement("img"),h.setAttribute("src","http://www.gravatar.com/avatar/"+i+"?d=retro&s=18")}this.currentUser=new a.User(c,h.src);var j=this.currentUser.imgHTML+c+' : <a href="#">Sign out</a>';b(g).html(j),a.Cookie.createCookie("username",c),a.Cookie.createCookie("img",h.src),m.addUser(String(c),String(h.src),l,function(){m.getVotes()})}},removeUser:function(){a.Cookie.eraseCookie("username"),a.Cookie.eraseCookie("img"),this.currentUser=null,b(g).html('<input id="login" type="text" placeholder="email">')},addActivity:function(a,c,d){var e="<li>"+a.imgHTML+a.username+' voted for <a href="#" data-fsid="'+d+'">'+c+"</li><hr/>";b(f).append(e)},showVotes:function(){var a=[];for(var c in this.voteFs.votes)a.push([this.voteFs.votes[c].name,this.voteFs.votes[c].user.length,this.voteFs.votes[c].id,this.voteFs.votes[c].user]);a.sort(function(a,b){return b[1]-a[1]});for(var d="",f=0;f<a.length;f++){d+="<li>"+a[f][1]+' for <a href="#" data-fsid="'+a[f][2]+'">'+a[f][0]+"</a></li>";for(var g=0;g<a[f][3].length;g++)d+=a[f][3][g].imgHTML}b(e).html(d)},findRests:function(a){var c="https://api.foursquare.com/v2/venues/search?ll="+this.location.coords.latitude+","+this.location.coords.longitude+"&client_id=NQNF2JL2VKJHXETAOND5TPJ23A2SWGZC4TXJEMLGJBXYMIJM&client_secret=TF1CC0HZVBJ0TM50CRNJNTWSOWZMIKQ30V4DEB4GC2UWZ3KM&v=20140128";c+=""!==a?"&query="+encodeURI(a):"&query="+encodeURI("restaurant");var d=this;b.getJSON(c,function(a){var b=a.response.venues;d.addSearchLayer(b)})},addAlert:function(a){n.removeClass("none"),n.html(a)},removeAlert:function(){n.addClass("none")}}}(window.Josh=window.Josh||{},window.jQuery),function(a,b){"use strict";a.Votes=function(){this.votes={}},a.Votes.prototype={addVote:function(a){var c=this.findByUser(a.user[0].username);if(void 0!==c)if(1===c.user.length)void 0===a.marker&&(a.marker=c.marker),a.id!==c.id&&b(this).trigger("removeLayer",c.marker);else for(var d=0;d<c.user.length;d++)c.user[d].username===a.user[0].username&&(this.votes[c.id]=c);var e=this.findByFs(a.id);void 0!==e?(e.user.push(a.user[0]),this.votes[e.id]=e):this.votes[a.id]=a},findByUser:function(a){for(var b in this.votes)for(var c=0;c<this.votes[b].user.length;c++)if(this.votes[b].user[c].username===a){var d=this.votes[b];return delete this.votes[b],d}},findByFs:function(a){var b=this.votes[a];return delete this.votes[a],b}}}(window.Josh=window.Josh||{},window.jQuery),function(){function a(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=k(g,a[0]),a[1]=k(h,a[1]),a[2]=k(i,a[2]),a[3]=k(j,a[3])}function b(a,b,c,d,e,f){return b=k(k(b,a),k(d,f)),k(b<<e|b>>>32-e,c)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function g(b){/[\x80-\xFF]/.test(b)&&(b=unescape(encodeURI(b))),txt="";var c,d=b.length,e=[1732584193,-271733879,-1732584194,271733878];for(c=64;c<=b.length;c+=64)a(e,h(b.substring(c-64,c)));b=b.substring(c-64);var f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(c=0;c<b.length;c++)f[c>>2]|=b.charCodeAt(c)<<(c%4<<3);if(f[c>>2]|=128<<(c%4<<3),c>55)for(a(e,f),c=0;16>c;c++)f[c]=0;return f[14]=8*d,a(e,f),e}function h(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function i(a){for(var b="",c=0;4>c;c++)b+=l[a>>8*c+4&15]+l[a>>8*c&15];return b}function j(a){for(var b=0;b<a.length;b++)a[b]=i(a[b]);return a.join("")}function k(a,b){return a+b&4294967295}function k(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}var l="0123456789abcdef".split("");md5=function(a){return j(g(a))},"5d41402abc4b2a76b9719d911017c592"!=md5("hello")}();